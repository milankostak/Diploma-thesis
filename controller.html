<!DOCTYPE html>
<html lang="en-GB" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Controller</title>
<script>
	var i = 0,
		tmpAlpha = 0,
		tmpBeta = 0,
		tmpGamma = 0;
	if (window.DeviceOrientationEvent) {
		console.log("DeviceOrientation is supported");
		window.addEventListener('deviceorientation', deviceOrientationHandler, false);
	}

	function deviceOrientationHandler(e) {
		// alpha is the compass direction the device is facing in degrees
		// var dir = e.alpha
		// beta is the front-to-back tilt in degrees, where front is positive
		// var beta = e.beta;
		// gamma is the left-to-right tilt in degrees, where right is positive
		// var gamma = e.gamma;
		if (i++ % 2 == 0) {
			tmpAlpha = e.alpha;
			tmpBeta = e.beta;
			tmpGamma = e.gamma;
		} else {
			let alphaToSend = (tmpAlpha + e.alpha) / 2.0;
			let betaToSend = (tmpBeta + e.beta) / 2.0;
			let gammaToSend = (tmpGamma + e.gamma) / 2.0;

			var request = new XMLHttpRequest();
			request.open('POST', "/show");
			request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
			var obj = {
				time: new Date().getTime(),
				sequence: i,
				alpha: alphaToSend,
				beta: betaToSend,
				gamma: gammaToSend
			};
			request.send(JSON.stringify(obj));
		}

	}

</script>
</head>
<body></body>
</html>